<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Запись на экскурсию в УФНС</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f5f5f5; color: #333; }
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
        .header { background: #2c3e50; color: white; padding: 30px 0; text-align: center; }
        .header h1 { margin-bottom: 10px; }
        .subtitle { color: #ecf0f1; font-size: 1.1em; }
        
        .calendar-nav { background: white; padding: 20px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-between; align-items: center; }
        .calendar-nav h2 { margin: 0; }
        .nav-buttons a { display: inline-block; padding: 10px 20px; background: #3498db; color: white; text-decoration: none; border-radius: 5px; margin: 0 5px; }
        .nav-buttons a:hover { background: #2980b9; }
        
        .legend { background: white; padding: 15px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .legend-items { display: flex; flex-wrap: wrap; gap: 15px; }
        .legend-item { display: flex; align-items: center; }
        .color-box { width: 20px; height: 20px; border-radius: 3px; margin-right: 8px; }
        .available { background: #2ecc71; }
        .limited { background: #f39c12; }
        .booked { background: #e74c3c; }
        .weekend { background: #95a5a6; }
        .past { background: #bdc3c7; }
        
        .calendar { background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .weekdays { display: grid; grid-template-columns: repeat(7, 1fr); background: #34495e; color: white; }
        .weekday { padding: 15px; text-align: center; font-weight: bold; }
        
        .week { display: grid; grid-template-columns: repeat(7, 1fr); border-bottom: 1px solid #eee; }
        .day { padding: 20px; min-height: 100px; border-right: 1px solid #eee; position: relative; }
        .day:last-child { border-right: none; }
        .day.empty { background: #f9f9f9; }
        .day-number { font-size: 1.2em; font-weight: bold; margin-bottom: 5px; }
        .day-status { font-size: 0.9em; padding: 3px 8px; border-radius: 3px; display: inline-block; }
        
        .day.available .day-number { color: #27ae60; }
        .day.limited .day-number { color: #e67e22; }
        .day.booked .day-number { color: #c0392b; }
        .day.weekend .day-number { color: #7f8c8d; }
        .day.past .day-number { color: #95a5a6; }
        
        .day-link { position: absolute; bottom: 10px; left: 10px; right: 10px; }
        .btn-book { display: block; width: 100%; padding: 8px; background: #3498db; color: white; border: none; border-radius: 5px; cursor: pointer; text-decoration: none; text-align: center; }
        .btn-book:hover { background: #2980b9; }
        .btn-book:disabled { background: #bdc3c7; cursor: not-allowed; }
        
        .stats { background: white; padding: 20px; margin: 20px 0; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); display: flex; justify-content: space-around; text-align: center; }
        .stat-item h3 { color: #2c3e50; margin-bottom: 10px; }
        .stat-value { font-size: 2em; font-weight: bold; color: #3498db; }
        
        .footer { text-align: center; margin-top: 40px; color: #7f8c8d; font-size: 0.9em; }
        .admin-link { position: fixed; bottom: 20px; right: 20px; background: #2c3e50; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none; }
        
        @media (max-width: 768px) {
            .day { padding: 10px; min-height: 80px; }
            .weekdays, .week { grid-template-columns: repeat(7, 1fr); }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="container">
            <h1>Запись на экскурсию в УФНС России</h1>
            <p class="subtitle">Выберите удобную дату для посещения налоговой службы</p>
        </div>
    </div>
    
    <div class="container">
        <div class="calendar-nav">
            <h2>{{ calendar.month_name }} {{ calendar.year }}</h2>
            <div class="nav-buttons">
                <a href="/month/{{ calendar.prev_year }}/{{ calendar.prev_month }}">← Назад</a>
                <a href="/">Сегодня</a>
                <a href="/month/{{ calendar.next_year }}/{{ calendar.next_month }}">Вперед →</a>
            </div>
        </div>
        
        <div class="legend">
            <h3>Обозначения:</h3>
            <div class="legend-items">
                <div class="legend-item">
                    <div class="color-box available"></div>
                    <span>Свободно (2 места)</span>
                </div>
                <div class="legend-item">
                    <div class="color-box limited"></div>
                    <span>Мало мест (1 место)</span>
                </div>
                <div class="legend-item">
                    <div class="color-box booked"></div>
                    <span>Нет мест</span>
                </div>
                <div class="legend-item">
                    <div class="color-box weekend"></div>
                    <span>Выходной</span>
                </div>
                <div class="legend-item">
                    <div class="color-box past"></div>
                    <span>Прошедшая дата</span>
                </div>
            </div>
        </div>
        
        <div class="calendar">
            <div class="weekdays">
                {% for weekday in calendar.weekdays %}
                <div class="weekday">{{ weekday }}</div>
                {% endfor %}
            </div>
            
            {% for week in calendar.weeks %}
            <div class="week">
                {% for day in week %}
                {% if day %}
                <div class="day {{ day.status }}">
                    <div class="day-number">{{ day.day }}</div>
                    <div class="day-info">
                        {% if day.status == 'available' %}
                        <span class="day-status" style="background: #d5f4e6; color: #27ae60;">Свободно: {{ day.available_slots }}</span>
                        {% elif day.status == 'limited' %}
                        <span class="day-status" style="background: #fef5e7; color: #e67e22;">Осталось: {{ day.available_slots }}</span>
                        {% elif day.status == 'booked' %}
                        <span class="day-status" style="background: #fadbd8; color: #c0392b;">Нет мест</span>
                        {% elif day.status == 'weekend' %}
                        <span class="day-status" style="background: #ecf0f1; color: #7f8c8d;">Выходной</span>
                        {% elif day.status == 'past' %}
                        <span class="day-status" style="background: #f2f3f4; color: #95a5a6;">Прошедший</span>
                        {% endif %}
                    </div>
                    
                    {% if day.status in ['available', 'limited'] %}
                    <div class="day-link">
                        <a href="/book/{{ day.date_str }}" class="btn-book">Записаться</a>
                    </div>
                    {% endif %}
                </div>
                {% else %}
                <div class="day empty"></div>
                {% endif %}
                {% endfor %}
            </div>
            {% endfor %}
        </div>
        
        <div class="stats">
            <div class="stat-item">
                <h3>Всего записей</h3>
                <div class="stat-value">{{ total_bookings }}</div>
            </div>
            <div class="stat-item">
                <h3>Текущий месяц</h3>
                <div class="stat-value">{{ calendar.month_name }}</div>
            </div>
            <div class="stat-item">
                <h3>Сегодня</h3>
                <div class="stat-value">{{ today.strftime('%d.%m.%Y') }}</div>
            </div>
        </div>
        
        <div class="footer">
            <p>© {{ today.year }} УФНС России. Система записи на экскурсии.</p>
            <p>Техническая поддержка: support@example.com</p>
        </div>
        
        <a href="/admin" class="admin-link">Админ-панель</a>
    </div>
</body>
</html>